---
format_version: 1.0.0
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git
trigger_map:
- pattern: scheduled
  workflow: scheduled
- pattern: "*"
  workflow: primary
workflows:
  primary:
    steps:
    - script:
        title: Check for skipping CI
        inputs:
        - content: |-
            #!/bin/bash

            if [[ -n "$(echo $GIT_CLONE_COMMIT_MESSAGE_SUBJECT | sed -n '/\[skip ci\]/p')"  ||
                  -n "$(echo $GIT_CLONE_COMMIT_MESSAGE_SUBJECT | sed -n '/\[ci skip\]/p')"  ||
                  -n "$(echo $GIT_CLONE_COMMIT_MESSAGE_BODY    | sed -n 's/\[skip ci\]/p')" ||
                  -n "$(echo $GIT_CLONE_COMMIT_MESSAGE_BODY    | sed -n 's/\[ci skip\]/p')" ]]; then
                envman add --key SKIPCI --value true
            else
                envman add --key SKIPCI --value false
            fi
    - script:
        title: Install OS X Dependencies
        inputs:
        - content: |-
            #!/bin/bash

            brew install pkg-config
    - script:
        title: Build Android SDK For arm
        inputs:
        - content: |-
            #!/bin/bash

            cd ../..
            pwd
            make android -j4
            gradle assemble
        - is_debug: 'yes'
    - script:
        title: Run Unit Tests
        inputs:
        - content: |-
            #!/bin/bash

            cd platform/android
            pwd
            ./gradlew testReleaseUnitTest --continue
        - is_debug: 'yes'
